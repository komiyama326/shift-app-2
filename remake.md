# シフト自動生成アプリ 改修仕様書 v1.0（remake.md）

## ■ 概要
本アプリは Python + PySide6 によるシフト自動生成アプリである。本仕様書では、以下 4 点の改修内容を定義する。

1. 月限定の固定シフト・休暇の優先順位の明確化（最優先扱い）  
2. 月限定固定シフト・休暇の「1件単位での削除」機能の追加  
3. 月限定固定シフト・休暇の「複数日一括追加」機能の追加  
4. Excel 出力カレンダーの日付フォントの統一（18pt）

---

# ■ 修正点 1：月限定設定の優先順位ルール

## ●目的
generation タブで設定する「月限定の固定シフト」「月限定の休暇」を、スタッフ不可曜日・ルール設定よりも優先させる。

## ●適用ファイル
- core_engine.py（ShiftScheduler._add_hard_constraints()）

## ●優先順位（最強 → 最弱）
1. 担当者不要日（no_shift_dates）  
2. 月限定休暇（generation タブ）  
3. 月限定固定シフト（generation タブ）  
4. 休暇ルール（Rule 設定タブ）  
5. ルールベース固定シフト（Rule 設定タブ）  
6. スタッフの固定不可曜日（Staff 設定タブ）

## ●仕様詳細
- 月限定設定が存在する場合、スタッフ固定不可曜日・ルールベース固定シフト・ルールベース休暇による制約は上書きされる。
- 月限定固定シフトと月限定休暇が衝突する場合は「月限定休暇」を優先する。
- 例外は投げず、内部で静かに解決する。

## ●テスト項目
- 月限定休暇がスタッフ不可曜日やルール固定を上書きするか  
- 月限定固定シフトがスタッフ不可曜日やルール休暇を上書きするか  
- 月限定固定シフトと月限定休暇の衝突時に休暇が優先されるか  

---

# ■ 修正点 2：月限定設定の「1件単位の削除」

## ●目的
月限定固定シフト・休暇が一人に複数日設定されている場合、1件だけ削除できるようにする。

## ●UI 仕様
- 月限定固定シフト／月限定休暇のリスト表示を「1行 = 1件（スタッフ名 × 日付）」の形式にする。
- 行選択 → 「削除」ボタンでその 1 件のみ削除可能。
- 複数選択での一括削除も許可する。

## ●適用ファイル
- generation_tab.py

## ●データ構造
- データは [(staff_name, date), ...] の 1 件単位リストとして扱う。

---

# ■ 修正点 3：複数日一括追加（オプション設定）

## ●目的
月限定固定シフト・休暇の追加時に、カレンダーから複数日を選択し、一括登録できるようにする。

## ●UI 仕様
- カレンダーで複数日を選択可能にする（クリックのトグル選択、Shift/Control 等、方法は任意）。
- 「追加」ボタン押下時に、選択されている日付をすべて追加する。
- (staff, date) が重複している場合はスキップ（警告不要）。

## ●適用ファイル
- generation_tab.py

## ●実装方針
- カレンダー内で複数選択状態を保持する内部ロジックを追加する。
- 「追加」ボタン処理をループ対応に変更。

---

# ■ 修正点 4：Excel 出力の日付フォント統一

## ●目的
Excel（グリッド形式）出力において、土日のフォントサイズが 14pt になっているため、平日と同じ 18pt に統一する。

## ●適用ファイル
- excel_exporter.py（_generate_grid_format()）

## ●仕様
- 日付セルのフォントサイズを曜日・祝日を問わず 18pt に統一する。

---

# ■ 追加方針（任意）
- 既存構造（タブ構成・SettingsManager・ShiftScheduler）を壊さず拡張すること。
- 必要に応じて補助関数を新規作成してよい。
- 最小限の print ログは許容。

---

# 以上
